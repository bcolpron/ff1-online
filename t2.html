<html>
<head>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
<style>
    body {
        margin: 0px;
        padding: 0px;
        width:  100%;
        height: 100%;
        overflow: hidden;
    }
    #viewport {
        background-color: blue;
        height: 384px;
        width: 640px;
        position: relative;
        overflow: hidden;
    }
    .character {
        position: absolute;
        transition: left 267ms, top 267ms;
        transition-timing-function: linear;
    }
    #background {
        position: absolute;
        transition: left 267ms, top 267ms;
        transition-timing-function: linear;
    }
</style>
<script type="text/javascript">

controller = {
    NONE : 0,
    UP : 1,
    DOWN : 2,
    LEFT : 4,
    RIGHT : 8,
    direction : 0,
    mask : 0
};

document.onkeyup = function(e) {
    switch (e.keyCode) {
        case 37:
            controller.mask &= 11; 
            if (controller.direction == controller.LEFT) controller.direction = controller.NONE;
            break;
        case 38:
            controller.mask &= 14; 
            if (controller.direction == controller.UP) controller.direction = controller.NONE;
            break;
        case 39:
            controller.mask &= 7; 
            if (controller.direction == controller.RIGHT) controller.direction = controller.NONE;
            break;
        case 40:
            controller.mask &= 13; 
            if (controller.direction == controller.DOWN) controller.direction = controller.NONE;
            break;
    }
    if (controller.direction == controller.NONE) {
        if (controller.mask & controller.LEFT && ! (controller.mask & controller.RIGHT)) controller.direction = controller.LEFT;
        else if (controller.mask & controller.RIGHT && ! (controller.mask & controller.LEFT)) controller.direction = controller.RIGHT;
        else if (controller.mask & controller.UP && ! (controller.mask & controller.DOWN)) controller.direction = controller.UP;
        else if (controller.mask & controller.DOWN && ! (controller.mask & controller.UP)) controller.direction = controller.DOWN;
    }
};
document.onkeydown = function(e) {
    switch (e.keyCode) {
        case 37:
            controller.mask |= controller.LEFT;
            controller.direction = controller.LEFT;
            startMove();
            break;
        case 38:
            controller.mask |= controller.UP;
            controller.direction = controller.UP;
            startMove();
            break;
        case 39:
            controller.mask |= controller.RIGHT;
            controller.direction = controller.RIGHT;
            startMove();
            break;
        case 40:
            controller.mask |= controller.DOWN;
            controller.direction = controller.DOWN;
            startMove();
            break;
    }
};

function move(){
    var direction = controller.direction;
    if (controller.mask ^ controller.LEFT|controller.RIGHT)

    switch (direction) {
        case controller.LEFT:
            var obj = document.getElementById("background");
            obj.style.left = parseInt(obj.style.left) + 32;
            $(".character").css("left", parseInt($(".character").css("left")) - 32);
            break;
        case controller.UP:
            var obj = document.getElementById("background");
            obj.style.top = parseInt(obj.style.top) + 32;
            $(".character").css("top", parseInt($(".character").css("top")) - 32);
            break;
        case controller.RIGHT:
            var obj = document.getElementById("background");
            obj.style.left = parseInt(obj.style.left) - 32;
            $(".character").css("left", parseInt($(".character").css("left")) + 32);
            break;
        case controller.DOWN:
            var obj = document.getElementById("background");
            obj.style.top = parseInt(obj.style.top) - 32;
            $(".character").css("top", parseInt($(".character").css("top")) + 32);
            break;
        case controller.NONE:
            stopMove();
    }
}

moveTimer = null;

function startMove() {
    if (!moveTimer) {
        moveTimer = setInterval(move, 267);
        move();
    }
}
function stopMove() {
    if (moveTimer) {
        clearInterval(moveTimer);
        moveTimer=null;
    }
}

</script>
</head>
<body>
    <div id="viewport">
        <div id="background" style="left:0px; top: 0px">
            <img src="worldmapX2.png" >
            <img class="character" src="images/bb.gif" style="left: 96px; top: 96px">
            <img class="character" src="images/bbup.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbleft.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbright.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbani.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbaniup.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbanileft.gif" style="left: 96px; top: 96px; display: none">
            <img class="character" src="images/bbaniright.gif" style="left: 96px; top: 96px; display: none">
        </div>
    </div>
</body>
</html>
